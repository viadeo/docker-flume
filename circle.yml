machine:
  timezone:
    Europe/Paris
  services:
    - docker
  environment:
    - DOCKER_IMAGE: viadeo/docker_flume

dependencies:
  pre:
    - sudo pip install awscli
  override:
    - docker info
    - docker build -t $DOCKER_IMAGE:$CIRCLE_SHA1 .

database:
  override:
    - echo "no database setup"

test:
  override:
    - export DOCKER_IMAGE ; ./run_tests.sh
    - aws cloudformation validate-template --template-body file://.ecs/template.yml

deployment:
  hub:
    branch: master
    commands:
      - .ecs/deploy.sh $CIRCLE_SHA1
